import __buffer_polyfill from 'vite-plugin-node-polyfills/shims/buffer'
import __global_polyfill from 'vite-plugin-node-polyfills/shims/global'
import __process_polyfill from 'vite-plugin-node-polyfills/shims/process'

globalThis.Buffer = globalThis.Buffer || __buffer_polyfill
globalThis.global = globalThis.global || __global_polyfill
globalThis.process = globalThis.process || __process_polyfill

import {
  __toESM,
  require_dist,
  require_dist2,
  require_dist3
} from "./chunk-O6J7OYVY.js";

// node_modules/openpgp/dist/lightweight/web-streams-adapter.min.mjs
var import_dist = __toESM(require_dist(), 1);
var import_dist2 = __toESM(require_dist2(), 1);
var import_dist3 = __toESM(require_dist3(), 1);
var t = function(e2, r2) {
  return t = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function(t2, e3) {
    t2.__proto__ = e3;
  } || function(t2, e3) {
    for (var r3 in e3) Object.prototype.hasOwnProperty.call(e3, r3) && (t2[r3] = e3[r3]);
  }, t(e2, r2);
};
function e(e2, r2) {
  if ("function" != typeof r2 && null !== r2) throw new TypeError("Class extends value " + r2 + " is not a constructor or null");
  function n2() {
    this.constructor = e2;
  }
  t(e2, r2), e2.prototype = null === r2 ? Object.create(r2) : (n2.prototype = r2.prototype, new n2());
}
function r(t2) {
  if (!t2) throw new TypeError("Assertion failed");
}
function n() {
}
function i(t2) {
  return "object" == typeof t2 && null !== t2 || "function" == typeof t2;
}
function o(t2) {
  if ("function" != typeof t2) return false;
  var e2 = false;
  try {
    new t2({ start: function() {
      e2 = true;
    } });
  } catch (t3) {
  }
  return e2;
}
function a(t2) {
  return !!i(t2) && "function" == typeof t2.getReader;
}
function s(t2) {
  return !!i(t2) && "function" == typeof t2.getWriter;
}
function u(t2) {
  return !!i(t2) && (!!a(t2.readable) && !!s(t2.writable));
}
function d(t2) {
  try {
    return t2.getReader({ mode: "byob" }).releaseLock(), true;
  } catch (t3) {
    return false;
  }
}
function h(t2) {
  r(function(t3) {
    return !!o(t3) && !!a(new t3());
  }(t2));
  var e2 = function(t3) {
    try {
      return new t3({ type: "bytes" }), true;
    } catch (t4) {
      return false;
    }
  }(t2);
  return function(r2, n2) {
    var i2 = (void 0 === n2 ? {} : n2).type;
    if ("bytes" !== (i2 = f(i2)) || e2 || (i2 = void 0), r2.constructor === t2 && ("bytes" !== i2 || d(r2))) return r2;
    if ("bytes" === i2) {
      var o2 = c(r2, { type: i2 });
      return new t2(o2);
    }
    o2 = c(r2);
    return new t2(o2);
  };
}
function c(t2, e2) {
  var n2 = (void 0 === e2 ? {} : e2).type;
  return r(a(t2)), r(false === t2.locked), "bytes" === (n2 = f(n2)) ? new y(t2) : new _(t2);
}
function f(t2) {
  var e2 = t2 + "";
  if ("bytes" === e2) return e2;
  if (void 0 === t2) return t2;
  throw new RangeError("Invalid type is specified");
}
var l = function() {
  function t2(t3) {
    this._underlyingReader = void 0, this._readerMode = void 0, this._readableStreamController = void 0, this._pendingRead = void 0, this._underlyingStream = t3, this._attachDefaultReader();
  }
  return t2.prototype.start = function(t3) {
    this._readableStreamController = t3;
  }, t2.prototype.cancel = function(t3) {
    return r(void 0 !== this._underlyingReader), this._underlyingReader.cancel(t3);
  }, t2.prototype._attachDefaultReader = function() {
    if ("default" !== this._readerMode) {
      this._detachReader();
      var t3 = this._underlyingStream.getReader();
      this._readerMode = "default", this._attachReader(t3);
    }
  }, t2.prototype._attachReader = function(t3) {
    var e2 = this;
    r(void 0 === this._underlyingReader), this._underlyingReader = t3;
    var i2 = this._underlyingReader.closed;
    i2 && i2.then(function() {
      return e2._finishPendingRead();
    }).then(function() {
      t3 === e2._underlyingReader && e2._readableStreamController.close();
    }, function(r2) {
      t3 === e2._underlyingReader && e2._readableStreamController.error(r2);
    }).catch(n);
  }, t2.prototype._detachReader = function() {
    void 0 !== this._underlyingReader && (this._underlyingReader.releaseLock(), this._underlyingReader = void 0, this._readerMode = void 0);
  }, t2.prototype._pullWithDefaultReader = function() {
    var t3 = this;
    this._attachDefaultReader();
    var e2 = this._underlyingReader.read().then(function(e3) {
      var r2 = t3._readableStreamController;
      e3.done ? t3._tryClose() : r2.enqueue(e3.value);
    });
    return this._setPendingRead(e2), e2;
  }, t2.prototype._tryClose = function() {
    try {
      this._readableStreamController.close();
    } catch (t3) {
    }
  }, t2.prototype._setPendingRead = function(t3) {
    var e2, r2 = this, n2 = function() {
      r2._pendingRead === e2 && (r2._pendingRead = void 0);
    };
    this._pendingRead = e2 = t3.then(n2, n2);
  }, t2.prototype._finishPendingRead = function() {
    var t3 = this;
    if (this._pendingRead) {
      var e2 = function() {
        return t3._finishPendingRead();
      };
      return this._pendingRead.then(e2, e2);
    }
  }, t2;
}();
var _ = function(t2) {
  function r2() {
    return null !== t2 && t2.apply(this, arguments) || this;
  }
  return e(r2, t2), r2.prototype.pull = function() {
    return this._pullWithDefaultReader();
  }, r2;
}(l);
function p(t2) {
  return new Uint8Array(t2.buffer, t2.byteOffset, t2.byteLength);
}
var y = function(t2) {
  function n2(e2) {
    var r2 = this, n3 = d(e2);
    return (r2 = t2.call(this, e2) || this)._supportsByob = n3, r2;
  }
  return e(n2, t2), Object.defineProperty(n2.prototype, "type", { get: function() {
    return "bytes";
  }, enumerable: false, configurable: true }), n2.prototype._attachByobReader = function() {
    if ("byob" !== this._readerMode) {
      r(this._supportsByob), this._detachReader();
      var t3 = this._underlyingStream.getReader({ mode: "byob" });
      this._readerMode = "byob", this._attachReader(t3);
    }
  }, n2.prototype.pull = function() {
    if (this._supportsByob) {
      var t3 = this._readableStreamController.byobRequest;
      if (t3) return this._pullWithByobRequest(t3);
    }
    return this._pullWithDefaultReader();
  }, n2.prototype._pullWithByobRequest = function(t3) {
    var e2 = this;
    this._attachByobReader();
    var r2 = new Uint8Array(t3.view.byteLength), n3 = this._underlyingReader.read(r2).then(function(r3) {
      var n4, i2, o2;
      e2._readableStreamController, r3.done ? (e2._tryClose(), t3.respond(0)) : (n4 = r3.value, i2 = t3.view, o2 = p(n4), p(i2).set(o2, 0), t3.respond(r3.value.byteLength));
    });
    return this._setPendingRead(n3), n3;
  }, n2;
}(l);
function v(t2) {
  return r(function(t3) {
    return !!o(t3) && !!s(new t3());
  }(t2)), function(e2) {
    if (e2.constructor === t2) return e2;
    var r2 = g(e2);
    return new t2(r2);
  };
}
function g(t2) {
  r(s(t2)), r(false === t2.locked);
  var e2 = t2.getWriter();
  return new b(e2);
}
var b = function() {
  function t2(t3) {
    var e2 = this;
    this._writableStreamController = void 0, this._pendingWrite = void 0, this._state = "writable", this._storedError = void 0, this._underlyingWriter = t3, this._errorPromise = new Promise(function(t4, r2) {
      e2._errorPromiseReject = r2;
    }), this._errorPromise.catch(n);
  }
  return t2.prototype.start = function(t3) {
    var e2 = this;
    this._writableStreamController = t3, this._underlyingWriter.closed.then(function() {
      e2._state = "closed";
    }).catch(function(t4) {
      return e2._finishErroring(t4);
    });
  }, t2.prototype.write = function(t3) {
    var e2 = this, r2 = this._underlyingWriter;
    if (null === r2.desiredSize) return r2.ready;
    var n2 = r2.write(t3);
    n2.catch(function(t4) {
      return e2._finishErroring(t4);
    }), r2.ready.catch(function(t4) {
      return e2._startErroring(t4);
    });
    var i2 = Promise.race([n2, this._errorPromise]);
    return this._setPendingWrite(i2), i2;
  }, t2.prototype.close = function() {
    var t3 = this;
    return void 0 === this._pendingWrite ? this._underlyingWriter.close() : this._finishPendingWrite().then(function() {
      return t3.close();
    });
  }, t2.prototype.abort = function(t3) {
    if ("errored" !== this._state) return this._underlyingWriter.abort(t3);
  }, t2.prototype._setPendingWrite = function(t3) {
    var e2, r2 = this, n2 = function() {
      r2._pendingWrite === e2 && (r2._pendingWrite = void 0);
    };
    this._pendingWrite = e2 = t3.then(n2, n2);
  }, t2.prototype._finishPendingWrite = function() {
    var t3 = this;
    if (void 0 === this._pendingWrite) return Promise.resolve();
    var e2 = function() {
      return t3._finishPendingWrite();
    };
    return this._pendingWrite.then(e2, e2);
  }, t2.prototype._startErroring = function(t3) {
    var e2 = this;
    if ("writable" === this._state) {
      this._state = "erroring", this._storedError = t3;
      var r2 = function() {
        return e2._finishErroring(t3);
      };
      void 0 === this._pendingWrite ? r2() : this._finishPendingWrite().then(r2, r2), this._writableStreamController.error(t3);
    }
  }, t2.prototype._finishErroring = function(t3) {
    "writable" === this._state && this._startErroring(t3), "erroring" === this._state && (this._state = "errored", this._errorPromiseReject(this._storedError));
  }, t2;
}();
function R(t2) {
  return r(function(t3) {
    return !!o(t3) && !!u(new t3());
  }(t2)), function(e2) {
    if (e2.constructor === t2) return e2;
    var r2 = w(e2);
    return new t2(r2);
  };
}
function w(t2) {
  r(u(t2));
  var e2 = t2.readable, n2 = t2.writable;
  r(false === e2.locked), r(false === n2.locked);
  var i2, o2 = e2.getReader();
  try {
    i2 = n2.getWriter();
  } catch (t3) {
    throw o2.releaseLock(), t3;
  }
  return new m(o2, i2);
}
var m = function() {
  function t2(t3, e2) {
    var r2 = this;
    this._transformStreamController = void 0, this._onRead = function(t4) {
      if (!t4.done) return r2._transformStreamController.enqueue(t4.value), r2._reader.read().then(r2._onRead);
    }, this._onError = function(t4) {
      r2._flushReject(t4), r2._transformStreamController.error(t4), r2._reader.cancel(t4).catch(n), r2._writer.abort(t4).catch(n);
    }, this._onTerminate = function() {
      r2._flushResolve(), r2._transformStreamController.terminate();
      var t4 = new TypeError("TransformStream terminated");
      r2._writer.abort(t4).catch(n);
    }, this._reader = t3, this._writer = e2, this._flushPromise = new Promise(function(t4, e3) {
      r2._flushResolve = t4, r2._flushReject = e3;
    });
  }
  return t2.prototype.start = function(t3) {
    this._transformStreamController = t3, this._reader.read().then(this._onRead).then(this._onTerminate, this._onError);
    var e2 = this._reader.closed;
    e2 && e2.then(this._onTerminate, this._onError);
  }, t2.prototype.transform = function(t3) {
    return this._writer.write(t3);
  }, t2.prototype.flush = function() {
    var t3 = this;
    return this._writer.close().then(function() {
      return t3._flushPromise;
    });
  }, t2;
}();
export {
  h as createReadableStreamWrapper,
  R as createTransformStreamWrapper,
  c as createWrappingReadableSource,
  w as createWrappingTransformer,
  g as createWrappingWritableSink,
  v as createWritableStreamWrapper
};
/*! Bundled license information:

openpgp/dist/lightweight/web-streams-adapter.min.mjs:
  (*! OpenPGP.js v5.11.2 - 2024-06-19 - this is LGPL licensed code, see LICENSE/our website https://openpgpjs.org/ for more information. *)

openpgp/dist/lightweight/web-streams-adapter.min.mjs:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)
*/
//# sourceMappingURL=web-streams-adapter.min-BUQUVRX7.js.map
